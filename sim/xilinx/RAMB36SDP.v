/***************************************************************************
 *                                                                         *
 *   RAMB36SDP.v - Emulates the Xilinx primitive of the same name for use  *
 *     with simulation using Icarus Verilog.                               *
 *                                                                         *
 *   Copyright (C) 2007 by Patrick Suggate                                 *
 *   patrick@physics.otago.ac.nz                                           *
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 *   This program is distributed in the hope that it will be useful,       *
 *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
 *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
 *   GNU General Public License for more details.                          *
 *                                                                         *
 *   You should have received a copy of the GNU General Public License     *
 *   along with this program; if not, write to the                         *
 *   Free Software Foundation, Inc.,                                       *
 *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
 ***************************************************************************/

`timescale 1ns/100ps
module RAMB36SDP (
	RDCLK,       // 1-bit read port clock
	WRCLK,       // 1-bit write port clock
	SSR,         // 1-bit synchronous output set/reset input
	RDEN,        // 1-bit read port enable
	WE,          // 8-bit write enable input
	WREN,        // 1-bit write port enable
	REGCE,       // 1-bit register enable input
	RDADDR,      // 9-bit read port address input
	WRADDR,      // 9-bit write port address input
	DI,          // 64-bit data input
	DIP,         // 8-bit parity data input
	DO,          // 64-bit data output
	DOP          // 8-bit parity data output
);


// RAMB36SDP parameters
// TODO: These are ignored ATM.
parameter	DO_REG			= 0;		// Optional output register (0 or 1)
parameter	EN_ECC_READ		= "FALSE";	// Enable ECC decoder, "TRUE" or "FALSE" 
parameter	EN_ECC_SCRUB		= "FALSE";	// Enable ECC scrubbing of RAM contents, "TRUE" or "FALSE"
parameter	SIM_COLLISION_CHECK	= "ALL";	// Collision check enable "ALL", "WARNING_ONLY", "GENERATE_X_ONLY" or "NONE"
parameter	EN_ECC_WRITE		= "FALSE";	// Enable ECC encoder, "TRUE" or "FALSE"
parameter	INIT	= 72'h000000000000000000;	// Initial values on output port
parameter	SRVAL	= 72'h000000000000000000;	// Set/Reset value for port output

// The following INIT_xx declarations specify the initial contents of the RAM
parameter	INIT_00	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_01	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_02	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_03	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_04	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_05	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_06	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_07	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_08	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_09	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_0A	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_0B	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_0C	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_0D	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_0E	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_0F	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_10	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_11	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_12	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_13	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_14	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_15	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_16	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_17	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_18	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_19	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_1A	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_1B	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_1C	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_1D	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_1E	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_1F	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_20	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_21	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_22	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_23	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_24	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_25	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_26	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_27	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_28	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_29	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_2A	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_2B	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_2C	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_2D	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_2E	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_2F	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_30	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_31	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_32	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_33	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_34	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_35	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_36	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_37	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_38	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_39	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_3A	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_3B	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_3C	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_3D	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_3E	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_3F	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_40	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_41	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_42	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_43	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_44	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_45	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_46	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_47	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_48	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_49	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_4A	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_4B	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_4C	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_4D	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_4E	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_4F	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_50	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_51	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_52	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_53	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_54	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_55	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_56	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_57	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_58	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_59	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_5A	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_5B	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_5C	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_5D	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_5E	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_5F	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_60	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_61	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_62	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_63	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_64	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_65	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_66	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_67	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_68	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_69	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_6A	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_6B	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_6C	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_6D	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_6E	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_6F	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_70	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_71	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_72	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_73	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_74	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_75	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_76	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_77	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_78	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_79	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_7A	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_7B	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_7C	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_7D	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_7E	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;
parameter	INIT_7F	= 256'h0000000000000000_0000000000000000_0000000000000000_0000000000000000;

// The next set of INITP_xx are for the parity bits
parameter	INITP_00	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_01	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_02	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_03	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_04	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_05	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_06	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_07	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_08	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_09	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_0A	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_0B	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_0C	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_0D	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_0E	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;
parameter	INITP_0F	= 256'h00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00;


input	RDCLK;
input	WRCLK;
input	SSR;
input	[7:0]	WE;
input	RDEN;
input	WREN;
input	REGCE;
input	[8:0]	RDADDR;
input	[8:0]	WRADDR;
input	[63:0]	DI;
input	[7:0]	DIP;
output	[63:0]	DO;
output	[7:0]	DOP;


reg	[63:0]	DO;
reg	[7:0]	DOP;


// 36-kbit of RAM
reg	[71:0]	ram36k [0:511];
reg	[71:0]	data;


always @(posedge RDCLK)
begin
	if (SSR)
		data	<= 0;
	else if (RDEN)
		data	<= ram36k [RDADDR];
end


always @(posedge RDCLK)
begin
	if (SSR)
	begin
		DO	<= 0;
		DOP	<= 0;
	end
	else if (REGCE)
	begin
		DO	<= data [63:0];
		DOP	<= data [71:64];
	end
end


always @(posedge WRCLK)
begin
	if (!SSR && WREN)
		ram36k [WRADDR]	<= {DIP, DI};
end


integer	i;
initial begin : Sim
	for (i=0; i<512; i=i+1)
		ram36k [i]	= 0;
`include "instructions.v"
end	// Sim


endmodule	// RAMB36SDP
